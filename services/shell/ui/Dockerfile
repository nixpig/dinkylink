FROM node:18.0.0
ARG SHELL_UI_PORT
ARG CREATE_UI_PUBLIC_HOST
ARG VIEW_UI_PUBLIC_HOST

ENV SHELL_UI_PORT=$SHELL_UI_PORT
ENV CREATE_UI_PUBLIC_HOST=$CREATE_UI_PUBLIC_HOST
ENV VIEW_UI_PUBLIC_HOST=$VIEW_UI_PUBLIC_HOST

WORKDIR /usr/src/app

COPY package.json package.json
COPY src src
COPY index.html index.html

RUN echo "CREATE_UI_PUBLIC_HOST=$CREATE_UI_PUBLIC_HOST" >> .env
RUN echo "VIEW_UI_PUBLIC_HOST=$VIEW_UI_PUBLIC_HOST" >> .env

RUN yarn && yarn build

CMD [ "sh", "-c", "npx http-server -p ${SHELL_UI_PORT} dist/"]

EXPOSE ${SHELL_UI_PORT}
