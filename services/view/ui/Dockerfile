FROM node:18.0.0
ARG VIEW_UI_PORT
ARG VIEW_SOCKET_PUBLIC_HOST
ARG VIEW_GO_PUBLIC_HOST

ENV VIEW_UI_PORT=$VIEW_UI_PORT
ENV VIEW_SOCKET_PUBLIC_HOST=$VIEW_SOCKET_PUBLIC_HOST
ENV VIEW_GO_PUBLIC_HOST=$VIEW_GO_PUBLIC_HOST

WORKDIR /usr/src/app

COPY package.json package.json
COPY src src
COPY index.html index.html

RUN echo "VIEW_SOCKET_PUBLIC_HOST=$VIEW_SOCKET_PUBLIC_HOST" >> .env
RUN echo "VIEW_GO_PUBLIC_HOST=$VIEW_GO_PUBLIC_HOST" >> .env

RUN yarn && yarn build

CMD ["sh", "-c", "npx http-server -p ${VIEW_UI_PORT} dist/"]

EXPOSE ${VIEW_UI_PORT}
